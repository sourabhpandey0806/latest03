pipeline {
  agent any
  environment {
    S3_BUCKET = "jenkinsartifacts23"
    AWS_REGION = "ap-south-1"
    AWS_ACCESS_KEY_ID = credentials('aws-access-key-id')
    AWS_SECRET_ACCESS_KEY = credentials('aws-secret-access-key')
  }
  stages {
    stage('Build') {
      steps {
        sh 'mvn clean install'
      }
    }
    stage('Publish to S3') {
      steps {
        withAWS(region: env.AWS_REGION, credentials: 'aws-credentials') {
          s3Upload(pathStyleAccessEnabled: true, payloadSigningEnabled: true, file: 'target/*.war', bucket: env.S3_BUCKET, acl: 'private')
        }
      }
    }
  }
}

